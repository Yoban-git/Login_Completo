@page "/AltaUsuarios"
@using PruebaLogin.Models.User
@using PruebaLogin.Models.Data
@using PruebaLogin.ViewModels.UserController
@inject UsuarioService _userService
@inject AppDbContext _context
@inject NavigationManager Nav

<div class="registration-container">
    <div class="form-card shadow-lg">
        <div class="header-section text-center mb-4">
            <div class="icon-circle">
                <i class="bi bi-person-plus-fill"></i>
            </div>
            <h3 class="text-white mt-3 fw-bold">Nuevo Registro</h3>
            <p class="text-muted small">Ingrese las credenciales del usuario</p>
        </div>

        <EditForm Model="nuevoUsuario" OnValidSubmit="GuardarUsuario">
            <DataAnnotationsValidator />
            
            <div class="mb-3">
                <label class="label-custom">Nombre Completo</label>
                <InputText class="input-custom" @bind-Value="nuevoUsuario.Name" placeholder="Ej.Nombre" />
                <ValidationMessage For="@(() => nuevoUsuario.Name)" />
            </div>

            <div class="mb-3">
                <label class="label-custom">Correo Electrónico</label>
                <InputText class="input-custom" @bind-Value="nuevoUsuario.Email" placeholder="usuario@empresa.com" />
                <ValidationMessage For="@(() => nuevoUsuario.Email)" />
            </div>

            <div class="mb-4">
                <label class="label-custom">Contraseña</label>
                <InputText type="password" class="input-custom" @bind-Value="nuevoUsuario.Password" placeholder="••••••••" />
                <ValidationMessage For="@(() => nuevoUsuario.Password)" />
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn-save">
                    @if (!string.IsNullOrEmpty(mensajeError))
                    {
                        <span class="spinner-border spinner-border-sm me-2"></span> <span>GUARDANDO...</span>
                    }
                    else
                    {
                        <span><i class="bi bi-save me-2"></i> REGISTRAR USUARIO</span>
                    }
                </button>
                <a href="/" class="btn-cancel text-center">CANCELAR</a>
            </div>
        </EditForm>

        @if (!string.IsNullOrEmpty(mensajeError))
        {
            <div class="alert alert-danger mt-3 small">
                @mensajeError
            </div>
        }
    </div>
</div>

@code {
    //private Usuario nuevoUsuario = new Usuario();
    private Usuarioguid nuevoUsuario = new Usuarioguid();
    private string mensajeError;
    private async Task GuardarUsuario()
    {
        //bool exito = await _userService.GuardarUsuarioAsync(nuevoUsuario);
        try
        {
            var exito = await _userService.GuardarUsuarioAsync(nuevoUsuario);

            if (!exito.Exito)
            {
                mensajeError = exito.Error;
            }

        }
        catch(Exception ex)
        {
            mensajeError = ex.Message;
        }
    }
}